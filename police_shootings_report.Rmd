---
title: "Exploring Fatal Police Shootings in the US"
author: "Thomas Roscher"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 2
---

```{r packages, message=F, warning=F, include=FALSE, results='hide'}
library(data.table)     # for fread() function
library(janitor)        # for clean variable names
library(lubridate)      # for working with dates
library(dplyr)          # for maipulating dataframes
library(stringr)        # for working with strings
library(ggplot2)        # for plotting
library(grid)           # for plotting
library(gridExtra)      # for plotting
library(tidyr)          # for function spread()
library(maps)           # getting map of US
library("RColorBrewer") # additional colors
library(extrafont)      # change font 
```

## INTRODCUTION

<p align="justify">
This project is part of the Udacity Degree Data Analyst and is supposed to showcase explorative data analysis (EDA) with R. Since I was allowed to use any dataset I decided against using any of the (to my mind rather boring) options provided by Udacity but instead chose to take a closer look at police shootings in the USA. This is possible in the first place because the Washington Post is compiling a database of every fatal shooting in the United States by a police officer in the line of duty since Jan. 1, 2015. You may wonder now, at least if you are not American, why I did not use any official governmental sources. The reason is simply that there is no reliable data (F.B.I. director James Comey has described the lack of data as "embarrassing and ridiculous"). Apparently, law enforcement agencies in the US must not provide even basic information about the lives they have taken. Which is shocking if one considers the national unrest the issue caused since the killing of Michael Brown in Ferguson. 
</p>

<p align="justify">
Note that, for this project I hide all code to give this paper the appearance of a small yet incomplete investigation rather then an R introduction for explorative plotting. However, as always everything is fully reproducible and the code (rmd.file) can be found on my GitHub account (https://github.com/ThomasRoscher). Also, due to the data structure which is kind of "one-sided event data", the portfolio of EDA techniques that I can demonstrate is rather limited. I hope that the content will make up for this drawback, though. 
</p>

## THE DATA

<p align="justify">
The dataset consists of 2132 instances were people were killed by police forces. It covers a time frame of 26 months, ranging from January 2015 to February 2017. It provides baseline information including the demographics of civilians killed (e.g., age, race, and mental illness), circumstances surrounding the event (e.g., civilian armed/unarmed and threat level), and the location of the event. More precisely, the following relevant variables are included:
</p>

* age of victim 
* race of victim
* date the shooting took place
* city the shooting took place
* state the shooting took place
* if victim showed signs of mental illness
* if victim attacked officers
* if and how victim was armed
* if the police used a body camera

<p align="justify">
Moreover, for each state I added it's total population and the population for blacks, whites, hispanics, and asians. I also added the total population for major cities where a large number of shootings occurred. Besides, before doing any plotting I changed each variable to it's appropriate type, checked for missing values, and re-leveled some factor variables.  
</p>

```{r get and prep data, include=FALSE}

get_data <- function(){
    # read individual datasets
    shootings   <- fread("shootings.csv", na.strings=c("","NA"))
    state_pop   <- fread("states_pop.csv", na.strings=c("","NA"))
    state_race  <- fread("states_races.csv", na.strings=c("","NA"))
    state_rural <- fread("states_rural.csv", na.strings=c("","NA"))
    # change state abbrivation so that it can be used as key 
    shootings$state <- state.name[match(shootings$state,state.abb)]
    # change name of state variable so that it can be used as key 
    names(shootings)[names(shootings) =="state"] <- "Location"
    # join datasets
    shootings <- shootings %>%
        inner_join(state_pop) %>%
        inner_join(state_race) %>%
        inner_join(state_rural) %>%
        # drop useless variables 
        select(-name, -Nonmetropolitan,-Total,-manner_of_death) %>%
        # rename state
        rename(state = Location) %>%
        # unify variable names
        clean_names()
    return(shootings)
}

city_pop    <- fread("city_pop.csv")

adjust_variable_types <- function(dataframe){
    # declare date 
    dataframe$date <- ymd(dataframe$date)
    # declare integers
    dataframe$black <- as.integer(dataframe$black)
    dataframe$asian <- as.integer(dataframe$asian)
    # declare to factors if number of unique values < 10 
    n_unique_levels   <- sapply(dataframe, function(x) length(unique(x)))
    factor_var_index  <- which(n_unique_levels < 10)
    dataframe[ ,factor_var_index] <- lapply(dataframe[ ,factor_var_index], factor)
    # declare to factors if string
    dataframe <- dataframe %>% mutate_if(is.character,as.factor)
    return(dataframe)
}

adjust_variables_values <- function(dataframe){
    # re-level variable armed
    dataframe <- dataframe %>%
    mutate(armed   = ifelse(str_detect(armed, "gun"), "gun", 
                     ifelse(str_detect(armed, "vehicle"), "vehicle",
                     ifelse(str_detect(armed, "toy weapon"), "toy",
                     ifelse(str_detect(armed, "unarmed"), "unarmed", "other"))))) %>%
    mutate(armed   = as.factor(armed)) %>%
    mutate(gender  = ifelse(str_detect(gender, "M"), "Male", 
                     ifelse(str_detect(gender, "F"), "Female", NA))) %>%
    mutate(threat_level = ifelse(str_detect(threat_level, "attack"), "clear_attack", "no_clear_attack")) %>%
    mutate(body_camera = ifelse(str_detect(body_camera, "TRUE"), "Yes", "No")) %>%
    mutate(signs_of_mental_illness = ifelse(str_detect(signs_of_mental_illness, "TRUE"), "Yes", "No"))   
    return(dataframe)
}

shootings <- get_data()

shootings <- adjust_variable_types(shootings)

shootings <- adjust_variables_values(shootings)
```

## HOW OFTEN AND WERE DID SHOOTINGS HAPPEN?

<p align="justify">
First, let's take a look how shootings developed over time. Plot 1 shows that from January 2015 to February 2017 on average 82 people per month have been fatally shot by police officers. With a shocking 987 victims in 2015 and 958 in 2016, numbers seem to be stable on a very high level. To further illustrate how absurdly big this number is, consider that in the first 24 days of 2015, police in the US fatally shot more people than police did in England and Wales, combined, over the past 24 years  (https://www.theguardian.com/us-news/2015/jun/09/the-counted-police-killings-us-vs-other-countries).
</p>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p1 <- shootings %>%
    group_by(date = floor_date(date, "month")) %>%
    summarise(shot = n()) %>%
    ggplot(aes(date, shot, group = 1)) +
        geom_point(size = 2) + 
        geom_line(color = "steelblue", size = 0.5) +
        geom_hline(aes(yintercept= mean(shot)), color = "red", linetype="dashed") +
        geom_text(aes(label=shot), vjust = -0.7, position = position_dodge(.9), size = 3) +
        ggtitle("P1: Fatal Police Shootings (Jan. 2015-Feb. 2017)") +
        xlab("") + 
        ylab("") + 
        theme(text=element_text(size=12, family="Comic Sans MS"))

p2 <- shootings %>%
    group_by(state) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    ggplot(aes(x = reorder(state, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        geom_hline(yintercept = 42.64, colour = "red", linetype = "dashed") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P2: Most leathal states (abs.)")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p3 <- shootings %>%
  group_by(state) %>%
  mutate(shot = n(), shot_100000 = (shot/total_residents)*100000) %>%
  select(state, shot_100000) %>%
  filter (! duplicated(shot_100000)) %>%
  arrange(desc(shot_100000)) %>%
  head(15) %>%
  ggplot(aes(x = reorder(state, shot_100000), y = shot_100000)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P3: Most leathal states (rel.)") +
        scale_x_discrete(position = "top")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p4 <- shootings %>%
    group_by(city) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    ggplot(aes(x = reorder(city, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        geom_hline(yintercept = 1.71, colour = "red", linetype = "dashed") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P4: Most leathal cities (abs.)")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

city_pop <- city_pop[,1:2]
p5 <- shootings %>%
    group_by(city) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    inner_join(city_pop) %>%
    mutate(shot_100000 = (shot/pop)*100000) %>%
    ggplot(aes(x = reorder(city, shot_100000), y = shot_100000)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P5: Most leathal cities (rel.)") +
        scale_x_discrete(position = "top")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
```

```{r, echo=FALSE, fig.align='center'}
p1
```

<p align="justify">
Next, I investigated which cities and states are especially prone to fatal police shootings. On average and in absolute numbers in each state 43 people were killed within the period considered (The median is 31.5 and may be a better measure because of the high numbers of Texas and California). There is a lot variation indicated by a standard deviation of 56. For, example there are 10 states which record less then 10 victims. On the other hand, we see that many states including Texas and California lie far above the average. To better put things into perspective plot 3 and plot 4 show victims per 100.000 residents. At this point the picture changes and we see that states such as Texas, Florida, and California aren't as bad as they initially appeared. Instead, New Mexico and surprisingly Alaska show high numbers. Arizona and Oklahoma remain somewhat the same. Regarding cities, we see that quiet surprisingly in relative terms L.A. is not as bad as expected yet many medium sized cities such as Bakersfield, Tucson, and Kansas City seem to have an issue.  
</p>

```{r, echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
grid.arrange(p2, p3, p4, p5, ncol = 2)
```

## WHAT ARE CHARACTERISTICS OF VICTIMS?

<p align="justify">
Next, I take a closer look at the victims. Plot 6 clearly shows that almost all victims were male. Most of them were between 18 and 35 years old. I was shocked when I realized that there were 39 killings of under-aged people! That is 39 kids being shot within about two years! The youngest victim being a 6-year-old autistic boy who was shot and killed during a traffic stop.
</p>

```{r, echo=FALSE, message=FALSE, warning=FALSE}
p6 <- shootings %>%
    ggplot(aes(x=age, fill=gender)) +
        geom_histogram(binwidth = 1) +
        geom_vline(xintercept = 18, colour = "red", linetype = "dashed") +
        geom_vline(xintercept = 35, colour = "red", linetype = "dashed") +
        xlab("") +
        ylab("") +
        ggtitle("P6: Victims age and gender") + 
        theme(legend.position="bottom") + 
        theme(legend.title=element_blank())+ 
        theme(text=element_text(size=12, family="Comic Sans MS"))

p7 <- shootings %>%
        group_by(threat_level) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = threat_level, y = shot)) +
            geom_bar(stat='identity', color = "steelblue", fill = "white") +
            xlab("") +
            ylab("") +
            ggtitle("P7: Were victims a clear thread?")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
p8 <- shootings %>%
        group_by(armed) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = armed, y = shot)) +
            geom_bar(stat='identity', color = "steelblue", fill = "white")+
            xlab("") +
            ylab("") +
            ggtitle("P8: Were victims armed?")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
p9 <- shootings %>%
        group_by(signs_of_mental_illness) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = signs_of_mental_illness, y = shot)) +
            geom_bar(stat='identity', color = "steelblue", fill = "white")+
            xlab("") +
            ylab("") +
            ggtitle("P9: Signs of mental illness?")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
p10 <- shootings %>%
        group_by(body_camera) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = body_camera, y = shot)) +
            geom_bar(stat='identity', color = "steelblue", fill = "white")+
            xlab("") +
            ylab("") +
            ggtitle("P10: Body camera worn?")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
```

```{r, echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
p6
```

<p align="justify">
Furthermore, we see that only 64 percent of the victims were attacking law enforcement or another civilian prior to their death. Though, only 7.2 percent were actually unarmed. Which may sound a bit odd at first sight but being armed does not necessarily mean that people were using the weapon. Moreover, about 25 percent showed signs of mental illness. Regarding body cameras which arguably may increase transparency and accountability for police, reduce police use of force and complaints of police misconduct, provide protection for officers and citizens, and improve evidence gathering and case processing we see that they were used only in about 10 percent of the instances. 
</p>

```{r, echo=FALSE, fig.align='center'}
grid.arrange(p7, p8, p9, p10, ncol = 2)
```

```{r, eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}
p11 <- shootings %>%
    ggplot() + 
    geom_bar(mapping = aes(x=body_camera, fill=threat_level), position = "fill", stat="count") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("Most leathal states (abs.)") +
        scale_fill_brewer(palette="Paired")
```

```{r, eval=FALSE, fig.align='center', include=FALSE}
p11
```

## RACIAL BIAS IN POLICE SHOOTINGS OR ABOUT THE LIMITATIONS OF DATA

<p align="justify">
Next, let's take a look at a potential race issue. In absolute terms we see that most people killed were white. More precisely, we see that 535 people were black, 367 were hispanic, and 1041 were white. So does that imply that there is not racial bias? Certainly not and you may think now that just comparing the numbers killed, to the corresponding numbers of that group in the general population is a good idea and provides us with a more reliable plot. And in fact doing so such as in plot 12 seems to changes the picture drastically, since the plot now implies that black people are about two and half times as likely to be victims of lethal police violence. We may even take this thought a step further as in plot 14 and check if this bias is more significant in some states then in others.
</p>

<p align="justify">
Undoubtedly, African-Americans are being killed disproportionately and by a wide margin. However, from the plots above and the data they are based on, can we surely say that racism is responsible? Arguably not because it may (or may not) also be the case that African-Americans just have a very large number of encounters with police officers and every police encounter contains a risk. (Though racism also have an indirect effect if it is the cause for disproportionately many police encounters). A more thoroughly approach would therefore compare how often people of each race get killed by police, with how often people of the same race get arrested by police. For this though, we would need reliable and complete data for each arrest taking place across the US. And to make things clear here I'm not saying that there is or is not a racial issue either for shootings or more general regarding police discrimination. I just wanted to show that plots often can be misleading if not correctly applied. EDA is not a tool for hypothesis testing and should not be wrongly misused as such. What EDA in this cases however clearly showed to my mind is that there is a problem with the amount of fatal police shootings, though reasons probably are diverse and may or may not include racism.
</p>

```{r, message=FALSE, warning=FALSE, include=FALSE}
p12 <- shootings %>% 
    filter(race =="B" | race == "W" | race == "H") %>%
    group_by(race) %>%
    summarize(shot = n()) %>%
    ggplot(aes(x = reorder(race, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P11: Shootings by race (absolute)")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p13 <- shootings %>%
  filter(!is.na(race), !is.na(armed))  %>%
  filter(race =="B" | race == "W" | race == "H") %>%
  mutate(unarmed = ifelse(str_detect(armed, "unarmed"), "unarmed", "armed")) %>%
  group_by(race, unarmed) %>%
  summarize(shot = n()) %>%
  ggplot() +
  geom_bar(mapping = aes(x=race, y=shot,  fill=unarmed),
           position = "fill",stat = "identity")+ 
  theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P14: Shootings on unarmed by race") +
  scale_fill_brewer(palette="Paired")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))+   
        theme(legend.title=element_blank()) 
    

p14 <- shootings %>%
    filter(race =="B" | race == "W" | race == "H") %>%
    mutate(white_total = sum(as.numeric(white), na.rm=TRUE), 
           black_total = sum(as.numeric(black), na.rm=TRUE), 
           hispa_total = sum(as.numeric(hispanic), na.rm=TRUE)) %>%
    group_by(race) %>%
    mutate(shot = n()) %>%
    mutate(shot_rel = ifelse(race == "B", shot/black_total*100000,
                      ifelse(race == "W", shot/white_total*100000,  shot/hispa_total*100000))) %>%
    select(race, shot_rel) %>% 
    filter (!duplicated(shot_rel)) %>% 
    ggplot(aes(x = reorder(race, shot_rel), y = shot_rel)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P12: Shootings by race (relative)") + 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p15 <- shootings %>%
    filter(!is.na(race)) %>%
    filter(race =="B" | race == "W" | race == "H") %>%
    mutate(white_total = sum(as.numeric(white), na.rm = TRUE), 
           black_total = sum(as.numeric(black), na.rm = TRUE), 
           hispa_total = sum(as.numeric(hispanic), na.rm = TRUE)) %>%
    group_by(race, state) %>%
    mutate(shot = n()) %>%
    mutate(shot_rel = ifelse(race == "B", shot/black_total*100000,
                      ifelse(race == "W", shot/white_total*100000,  shot/hispa_total*100000))) %>%
    select(race, shot_rel, state) %>% 
    filter (!duplicated(shot_rel)) %>% 
    filter(race =="B" | race == "W") %>%
    spread(race, shot_rel) %>% 
    mutate(ratio = B/W) %>%
    na.omit %>%
    ungroup() %>%
    mutate(ratio2 = ifelse(ratio > 1, ratio, 0-ratio)) %>%
    arrange(ratio) %>%
    #head(15) %>%
    ggplot(aes(x = reorder(state, ratio2), y = ratio2)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P13: Ratio black victims per 100.000/white victims per 100.000")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))
```

```{r, echo=FALSE, fig.align='center'}
grid.arrange(p12, p14, ncol = 2)
```

```{r, echo=FALSE, fig.align='center'}
p15
```

<p align="justify">
Given the data structure there is one last different perspective on which we can take a look on? While this approach is still not perfect it surely is better then the "race corrected" resident numbers. So are blacks more likely to get shot if they are unarmed? Here, plot 15 indicates that there in fact may be a problem of racism. While 12 percent of the black victims were unarmed the same holds true only for 6 percent of the white people. Again, however this simply plot is not sufficient to give any reliable results regarding the cause since it does not preclude confounding variables. 
</p>

```{r, echo=FALSE, fig.align='center'}
p13
```

```{r, message=FALSE, warning=FALSE, include=FALSE}
# get state coordinates 
state.coords <- map_data("state")
state.coords$region <- str_to_title(state.coords$region)
names(state.coords)[names(state.coords)=="region"] <- "state"

# get shootings per state
state_data <- shootings %>%
    group_by(state) %>%
    summarize(dead = n()) %>%
    mutate(victims = ifelse(dead <= 10, "0-10",
                     ifelse(dead > 10 & dead <= 25, "11-25",
                     ifelse(dead > 25 & dead <= 50, "26-50",
                     ifelse(dead > 50 & dead <= 100, "51-100",
                     ifelse(dead > 100 & dead <= 150, "101-150", "151-355")))))) %>%
    mutate(victims = as.factor(victims))

# join
state.dat <- state.coords %>%
    inner_join(state_data)

# set levels for plot later on 
state.dat$victims <- factor(state.dat$victims, 
                     levels=c("0-10", "11-25", "26-50","51-100","101-150","151-355"), 
                     labels=c("0-10", "11-25", "26-50","51-100","101-150","151-355"))

# basic map
map <- ggplot(state.dat)
map <- map + theme_bw()
map <- map + geom_polygon(aes(x = long, y = lat, group = group,fill = factor(victims)),
                          colour = "white", lwd = 0.3)
map <- map + coord_map(project="conic", lat0 = 30) 

# create color scale 
colors <-brewer.pal(9, 'PuBu')
pal <-colorRampPalette(colors)

# add a colors and a legend and title
map <- map + scale_fill_manual(name="", values = pal(12) )
map <- map + guides(fill = guide_legend(override.aes = list(colour = NULL)))
map <- map + labs(title="P15: Fatal Police Shootings (Jan. 2015-Feb. 2017)")

# blank axis ticks
map <- map + theme(axis.ticks = element_blank(),
                   axis.text.x = element_blank(),
                   axis.text.y = element_blank(),
                   axis.title.x= element_blank(),
                   axis.title.y= element_blank())
# hide gridlines
map <- map + theme(panel.grid.minor=element_blank(),
                   panel.grid.major=element_blank())
```

<p align="justify">
Lastly, I also wanted to show the value of choropleth maps if you want to compare values across regions. Plot 15 is a simple and clean choropleth map showing number of shootings across the different states of the US.  
</p>
    
```{r, echo=FALSE, fig.align='center'}
map
```

## CONCLUSION

<p align="justify">
I found that dataset to be very important, shocking, and interesting and the same time since it gave me an overview about the extend of fatal police shootings. And while the data was "cleaning-wise" not very challenging and also had it's limitation "plot-wise" (no "real" dependent variable) it still offers an excellent example for the limitation of EDA which is not a substitute for a proper statistical method but rather precedes it. While this should be natural and no new information I watched an interesting yet older episode of "Last Weeks Tonight" covering the use/misuse of data and scientific results in the media causing myself to think that for many people this is not the case. Finally, and I think I made that already clear enough to fully understand the problem we must collect much more sufficient data including non-lethal instances and more detail in general. The trouble is, that data could take years to compile. Lastly, I'm far from an expert in this topic but the following studies seem to provide more yet contradicting information:

* Freyer, Roland, 2016: An Empirical Analysis of Racial Differences in Police Use of Force
* Nix, Justin, 2017: A Bird's Eye View of Civilians Killed by Police in 2015 

## APPENDIx

```{r, message=FALSE, warning=FALSE}

## function read and join datasets
get_data <- function(){
    # read individual datasets
    shootings   <- fread("shootings.csv", na.strings=c("","NA"))
    state_pop   <- fread("states_pop.csv", na.strings=c("","NA"))
    state_race  <- fread("states_races.csv", na.strings=c("","NA"))
    state_rural <- fread("states_rural.csv", na.strings=c("","NA"))
    # change state abbrivation so that it can be used as key 
    shootings$state <- state.name[match(shootings$state,state.abb)]
    # change name of state variable so that it can be used as key 
    names(shootings)[names(shootings) =="state"] <- "Location"
    # join datasets
    shootings <- shootings %>%
        inner_join(state_pop) %>%
        inner_join(state_race) %>%
        inner_join(state_rural) %>%
        # drop useless variables 
        select(-name, -Nonmetropolitan,-Total,-manner_of_death) %>%
        # rename state
        rename(state = Location) %>%
        # unify variable names
        clean_names()
    return(shootings)
}

city_pop    <- fread("city_pop.csv")

## function to adjust datatypes
adjust_variable_types <- function(dataframe){
    # declare date 
    dataframe$date <- ymd(dataframe$date)
    # declare integers
    dataframe$black <- as.integer(dataframe$black)
    dataframe$asian <- as.integer(dataframe$asian)
    # declare to factors if number of unique values < 10 
    n_unique_levels   <- sapply(dataframe, function(x) length(unique(x)))
    factor_var_index  <- which(n_unique_levels < 10)
    dataframe[ ,factor_var_index] <- lapply(dataframe[ ,factor_var_index], factor)
    # declare to factors if string
    dataframe <- dataframe %>% mutate_if(is.character,as.factor)
    return(dataframe)
}

## function to adjust some variable values
adjust_variables_values <- function(dataframe){
    # re-level variable armed
    dataframe <- dataframe %>%
    mutate(armed   = ifelse(str_detect(armed, "gun"), "gun", 
                     ifelse(str_detect(armed, "vehicle"), "vehicle",
                     ifelse(str_detect(armed, "toy weapon"), "toy",
                     ifelse(str_detect(armed, "unarmed"), "unarmed", "other"))))) %>%
    mutate(armed   = as.factor(armed)) %>%
    mutate(gender  = ifelse(str_detect(gender, "M"), "Male", 
                     ifelse(str_detect(gender, "F"), "Female", NA))) %>%
    mutate(threat_level = ifelse(str_detect(threat_level, "attack"), "clear_attack", "no_clear_attack")) %>%
    mutate(body_camera = ifelse(str_detect(body_camera, "TRUE"), "Yes", "No")) %>%
    mutate(signs_of_mental_illness = ifelse(str_detect(signs_of_mental_illness, "TRUE"), "Yes", "No"))   
    return(dataframe)
}
```



