---
title: "Exploring Fatal Police Shootings in the US"
author: "Thomas Roscher"
date: "`r Sys.Date()`"
output:
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true
    toc_depth: 2
---

```{r global_options, include=FALSE}
knitr::opts_chunk$set(fig.width=12, fig.height=8, fig.path='Figs/',
                      echo=FALSE, warning=FALSE, message=FALSE)
```

```{r packages, message=F, warning=F, include=FALSE, results='hide'}
library(data.table)     # for fread() function
library(janitor)        # for clean variable names
library(lubridate)      # for working with dates
library(dplyr)          # for maipulating dataframes
library(stringr)        # for working with strings
library(ggplot2)        # for plotting
library(grid)           # for plotting
library(gridExtra)      # for plotting
library(tidyr)          # for function spread()
library(maps)           # getting map of US
library("RColorBrewer") # additional colors
library(extrafont)      # change font
library(VIM)            # visualize NAs
library(fiftystater)    # get alaska and hawei on the map
```

## INTRODUCTION

<p align="justify">
This project is part of the Udacity Degree Data Analyst and is supposed to showcase explorative data analysis (EDA) with R. Since I was allowed to use any dataset I decided against using any of the (to my mind rather boring) options provided by Udacity but instead chose to take a closer look at police shootings in the USA. This is possible in the first place because the Washington Post is compiling a database of every fatal shooting in the United States by a police officer in the line of duty since Jan. 1, 2015. You may wonder now, at least if you are not American, why I did not use any official governmental sources. The reason is simply that there is no reliable data (F.B.I. director James Comey has described the lack of data as "embarrassing and ridiculous"). Apparently, law enforcement agencies in the US must not provide even basic information about the lives they have taken. Which is shocking if one considers the national unrest the issue caused since the killing of Michael Brown in Ferguson. 
</p>

<p align="justify">
Note that, for this project I hide all code to give this paper the appearance of a small yet incomplete investigation rather then an R introduction for explorative plotting. However, as always everything is fully reproducible and the code (rmd.file) can be found on my GitHub account (https://github.com/ThomasRoscher). Also, due to the data structure which is kind of "one-sided event data", the portfolio of EDA techniques that I can demonstrate is rather limited. Also due to the data format and due to not having a pre-defined hypothesis, I proceed a bit different then I would usually do. That is I proceed topic wise instead of univariate (plot all variables), bivariate (plot each independent variable with the dependent one) and multivariate (add potentially interacting or confounding variables) exploration. Besides, I polish each plot more then usually required for EDA. I hope that the content will make up for this drawback, though. 
</p>

## THE DATA

<p align="justify">
The dataset consists of 2132 instances were people were killed by police forces. It covers a time frame of 26 months, ranging from January 2015 to February 2017. It provides baseline information including the demographics of civilians killed (e.g., age, race, and mental illness), circumstances surrounding the event (e.g., civilian armed/unarmed and threat level), and the location of the event. More precisely, the following relevant variables are included:
</p>

* age of victim 
* race of victim
* date the shooting took place
* city the shooting took place
* state the shooting took place
* if victim showed signs of mental illness
* if victim attacked officers
* if and how victim was armed
* if victim was fleeing
* if the police used a body camera

<p align="justify">
Moreover, for each state I added it's total population and the population for blacks, whites, hispanics, and asians. I also added the total population for major cities where a large number of shootings occurred. Besides, before doing any plotting I changed each variable to it's appropriate type, checked for missing values (see plot 20 in the Appendix), and re-leveled some factor variables. If you want to take a quick glimpse at the data you'll find some basic information about each variable in the appendix. All user written functions used are listed there as well. 
</p>

```{r get and prep data, include=FALSE}
get_data <- function(){
    # read individual datasets
    shootings   <- fread("shootings.csv", na.strings=c("","NA"))
    state_pop   <- fread("states_pop.csv", na.strings=c("","NA"))
    state_race  <- fread("states_races.csv", na.strings=c("","NA"))
    state_rural <- fread("states_rural.csv", na.strings=c("","NA"))
    # change state abbrivation so that it can be used as key 
    shootings$state <- state.name[match(shootings$state,state.abb)]
    # change name of state variable so that it can be used as key 
    names(shootings)[names(shootings) =="state"] <- "Location"
    # join datasets
    shootings <- shootings     %>%
        inner_join(state_pop)  %>%
        inner_join(state_race) %>%
        inner_join(state_rural)%>%
        # drop useless variables 
        select(-name, -Nonmetropolitan,-Total) %>%
        # rename some variables
        rename(state  = Location)        %>%
        rename(manner = manner_of_death) %>%
        rename(camera = body_camera)     %>%
        rename(mental = signs_of_mental_illness) %>%
        rename(threat = threat_level)    %>%
        # unify variable names
        clean_names()
    return(shootings)
}

adjust_variables_values <- function(df){
    # re-level variable armed
    df <- df %>%
    mutate(armed = ifelse(str_detect(armed, "gun"), "gun", 
                   ifelse(str_detect(armed, "vehicle"), "vehicle",
                   ifelse(str_detect(armed, "toy weapon"), "toy",
                   ifelse(str_detect(armed, "unarmed"), "unarmed", 
                          "other"))))) %>%
    # change values gender
    mutate(gender = ifelse(str_detect(gender, "M"), "Male", 
                    ifelse(str_detect(gender, "F"), "Female", NA))) %>%
    # re-level variable threat
    mutate(threat = ifelse(str_detect(threat, "attack"), "clear_attack", 
                           "no_clear_attack")) %>%
    # change values camera
    mutate(camera = ifelse(str_detect(camera, "TRUE"), "Yes", "No")) %>%
    # change values mental
    mutate(mental = ifelse(str_detect(mental, "TRUE"), "Yes", "No"))   
    return(df)
}

adjust_variable_types <- function(df){
    # declare date 
    df$date <- ymd(df$date)
    # declare integers
    df$black <- as.integer(df$black)
    df$asian <- as.integer(df$asian)
    # declare to factors if number of unique values < 10 
    n_unique_levels   <- sapply(df, function(x) length(unique(x)))
    factor_var_index  <- which(n_unique_levels < 10)
    df[ ,factor_var_index] <- lapply(df[ ,factor_var_index], factor)
    # declare to factors if string
    df <- df %>% 
        mutate_if(is.character,as.factor)
    return(df)
}

city_pop  <- fread("city_pop.csv")

shootings <- get_data()

shootings <- adjust_variables_values(shootings)

shootings <- adjust_variable_types(shootings)
```

## HOW OFTEN AND WHERE DID SHOOTINGS HAPPEN?

<p align="justify">
First, let's take a look how shootings developed over time. Plot 1 shows that from January 2015 to February 2017 on average 82 people per month have been fatally shot by police officers. With a shocking 987 victims in 2015 and 958 in 2016, numbers seem to be stable on a very high level. To further illustrate how absurdly big this number is, consider that in the first 24 days of 2015, police in the US fatally shot more people than police did in England and Wales, combined, over the past 24 years  (https://www.theguardian.com/us-news/2015/jun/09/the-counted-police-killings-us-vs-other-countries).
</p>

```{r plot 1-5 code, echo=FALSE, message=FALSE, warning=FALSE}
p1 <- shootings %>%
    group_by(date = floor_date(date, "month")) %>%
    summarise(shot = n()) %>%
    ggplot(aes(date, shot, group = 1)) +
        geom_point(size = 2) + 
        geom_line(color = "steelblue", 
                  size = 1) +
        geom_hline(aes(yintercept = mean(shot)), 
                   color = "red", 
                   linetype = "dashed") +
        geom_text(aes(label = shot), 
                  vjust = -0.7, 
                  position = position_dodge(.9), 
                  size = 5) +
        ggtitle("P1: Total Fatal Police Shootings in the US (Monthly, Jan. 2015-Feb. 2017)") +
        xlab("Time") + 
        ylab("Number of leathal shootings") + 
        theme(text = element_text(size = 13, family = "Comic Sans MS"))  +
        annotate(geom="text",x=as.Date("2015-01-10"),y=105,label="Total: 2132",fontface="bold",size = 5)+
        annotate(geom="text",x=as.Date("2015-01-10"),y=103,label=" 2015:  987",fontface="bold",size = 5)+
        annotate(geom="text",x=as.Date("2015-01-10"),y=101,label=" 2016:  958",fontface="bold",size = 5)+
        annotate(geom="text",x=as.Date("2015-01-01"),y=83,label="mean=82",fontface="bold",size = 3)

p2 <- shootings %>%
    group_by(state) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    ggplot(aes(x = reorder(state, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        geom_hline(yintercept = 42.64, colour = "red", linetype = "dashed") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P2: Most leathal states (absolute)")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p3 <- shootings %>%
  group_by(state) %>%
  mutate(shot = n(), shot_100000 = (shot/total_residents)*100000) %>%
  select(state, shot_100000) %>%
  filter (! duplicated(shot_100000)) %>%
  arrange(desc(shot_100000)) %>%
  head(15) %>%
  ggplot(aes(x = reorder(state, shot_100000), y = shot_100000)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        geom_hline(yintercept = 0.75, colour = "red", linetype = "dashed") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P3: Most leathal states (per 100.000)") +
        scale_x_discrete(position = "top")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p4 <- shootings %>%
    group_by(city) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    ggplot(aes(x = reorder(city, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        geom_hline(yintercept = 1.71, colour = "red", linetype = "dashed") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P4: Most leathal cities (absolute)")+ 
        theme(text=element_text(size = 8, family ="Comic Sans MS"))

city_pop <- city_pop[,1:2]

p5 <- shootings %>%
    group_by(city) %>%
    summarize(shot = n()) %>%
    ungroup() %>%
    arrange(desc(shot)) %>%
    head(15) %>%
    inner_join(city_pop) %>%
    mutate(shot_100000 = (shot/pop)*100000) %>%
    ggplot(aes(x = reorder(city, shot_100000), y = shot_100000)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P5: Most leathal cities (per 100.000)") +
        scale_x_discrete(position = "top")+ 
        theme(text=element_text(size = 8, family = "Comic Sans MS"))
```

```{r execute p1, echo=FALSE, fig.align='center'}
p1
```

<p align="justify">
Next, I investigated which cities and states are especially prone to fatal police shootings to. On average and in absolute numbers in each state 43 people were killed within the period considered (The median is 31.5 and may be a better measure because of the high numbers of Texas and California). There is a lot of variation indicated by a standard deviation of 56. For, example there are 10 states which record less then 10 victims. On the other hand, we see that many states including Texas and California lie far above the average. To better put things into perspective plot 3 and plot 4 show victims per 100.000 residents. At this point the picture changes and we see that states such as Texas, Florida, and California are not as exceptional they initially appeared. Instead, New Mexico and surprisingly Alaska show high numbers. Arizona and Oklahoma remain somewhat the same. Regarding cities, we see that quiet surprisingly in relative terms L.A. is not as bad as expected yet many medium sized cities such as Bakersfield, Tucson, and Kansas City seem to have an issue. In sum, investigating the geographical distribution, we see that deadly police encounters are not only restricted to a view places in the US but rather seem to be a nationwide problem.
</p>

```{r execute p2-p5, echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
grid.arrange(p2, p3, p4, p5, ncol = 2)
```

## WHAT ARE CHARACTERISTICS OF VICTIMS?

<p align="justify">
Next, I take a closer look at the victims. Plot 6 clearly shows that almost all victims were male. Most of them were between 18 and 35 years old. I was shocked when I realized that there were 39 killings of under-aged people! That is 39 kids being shot within about two years! The youngest victim being a 6-year-old autistic boy who was shot and killed during a traffic stop.
</p>

```{r plot 6-12 code, echo=FALSE, message=FALSE, warning=FALSE}
p6 <- shootings %>%
    ggplot(aes(x=age, fill=gender)) +
        geom_histogram(binwidth = 1) +
        geom_vline(xintercept = 18, colour = "red", linetype = "dashed") +
        geom_vline(xintercept = 35, colour = "red", linetype = "dashed") +
        xlab("") +
        ylab("") +
        ggtitle("P6: Victims age and gender") + 
        theme(legend.position = "bottom") + 
        theme(legend.title=  element_blank())+ 
        theme(text=element_text(size=12, family ="Comic Sans MS"))

p7 <- shootings %>%
        group_by(threat) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = threat, y = shot)) +
            geom_bar(stat ='identity', color = "steelblue", fill = "white") +
            xlab("") +
            ylab("") +
            ggtitle("P7: Were victims a clear thread?")+ 
            theme(text = element_text(size = 8, family = "Comic Sans MS")) 
                                   

p8 <- shootings %>%
        group_by(armed) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = armed, y = shot)) +
            geom_bar(stat ='identity', color = "steelblue", fill = "white") +
            xlab("") +
            ylab("") +
            ggtitle("P8: Were victims armed?")+ 
            theme(text=element_text(size = 8, family = "Comic Sans MS"))

p9 <- shootings %>%
        group_by(mental) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = mental, y = shot)) +
            geom_bar(stat ='identity', color = "steelblue", fill = "white" )+
            xlab("") +
            ylab("") +
            ggtitle("P9: Signs of mental illness?")+ 
            theme(text=element_text(size = 8, family = "Comic Sans MS"))

p10 <- shootings %>%
        group_by(camera) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = camera, y = shot)) +
            geom_bar(stat ='identity', color = "steelblue", fill = "white") +
            xlab("") +
            ylab("") +
            ggtitle("P10: Body camera worn?")+ 
            theme(text=element_text(size = 8, family = "Comic Sans MS"))

p11 <- shootings %>%
        group_by(flee) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = flee, y = shot)) +
            geom_bar(stat ='identity', color = "steelblue", fill = "white")+
            xlab("") +
            ylab("") +
            ggtitle("P11: Fleeing?")+ 
            theme(text = element_text(size = 8, family = "Comic Sans MS"))

p12 <- shootings %>%
        group_by(manner) %>%
        summarize(shot = n()) %>%
        ggplot(aes(x = manner, y = shot)) +
            geom_bar(stat='identity', color = "steelblue", fill = "white")+
            xlab("") +
            ylab("") +
            ggtitle("P12: Tazered and shot?")+ 
            theme(text = element_text(size = 8, family = "Comic Sans MS"))
```

```{r execute p6, echo=FALSE, fig.align='center', message=FALSE, warning=FALSE}
p6
```

<p align="justify">
Furthermore, we see that only 64 percent of the victims were attacking law enforcement or another civilian prior to their death. Though, only 7.2 percent were actually unarmed. Which may sound a bit odd at first sight but being armed does not necessarily mean that people were using the weapon. Moreover, about 25 percent showed signs of mental illness. Regarding body cameras which arguably may increase transparency and accountability for police, reduce police use of force and complaints of police misconduct, provide protection for officers and citizens, and improve evidence gathering and case processing we see that they were used only in about 10 percent of the instances. Besides, a small portion of the victims were even tased and shot and most people were not fleeing. Yet, not fleeing does not inevitably mean that victims did not posed a thread. Unfortunately, a to my mind important variable is missing, that is, if and how people resisted arrest, or more general did not comply with any instructions given by the officers. This may include passive resistance (e.g. not leaving the car) or violent yet unarmed resistance (e.g. beat the cop). In order to get reliable data in this regard the comprehensive use of body cameras is crucial. 
</p>

```{r execute p7-p12, echo=FALSE, fig.align='center'}
grid.arrange(p7, p8, p9, p10, p11, p12, ncol = 2)
```

```{r plot 13-14 code, message=FALSE, warning=FALSE, include=FALSE}
p13 <- shootings %>%
    ggplot() + 
        geom_bar(mapping = aes(x=camera, fill=threat), 
                 position = "fill", stat="count") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P13: Potential influence of cameras I") +
        scale_fill_brewer(palette="Paired") +
        theme(text=element_text(size=8, family="Comic Sans MS")) +
        theme(legend.position="bottom") +
        labs(fill="")

p14 <- shootings %>%
    mutate(armed=ifelse(str_detect(armed, "unarmed"), "unarmed", "armed")) %>%
    ggplot() + 
        geom_bar(mapping=aes(x=camera, fill=armed), 
                 position="fill", stat="count") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P14: Potential influence of cameras II") +
        scale_fill_brewer(palette = "Paired") + 
        theme(text=element_text(size=8, family="Comic Sans MS")) +
        theme(legend.position="bottom") +
        labs(fill="")
```

<p align="justify">
Next, lets take a look if the assistance of body cameras may influence the officers assessment of the situation. Surprisingly, in plot 13 and 14 we see that in situation were such cameras were used, not only were victims more often assessed as no clear threat but also were they more often categorized as unarmed. There are a number of possible explanations - perhaps, the presence of surveillance inhibits direct expressions of violence of civilians. On the other hand, it may be that incidents without video evidence are more likely to be marked as 'attacks' threat level because there is less obvious proof otherwise i.e. do police without body-cameras over-report the presence of 'attack' threats? These are speculative and demand more rigorous analysis with more data. (see https://www.kaggle.com/reseal05/an-eda-of-fatal-police-shootings ).    
</p>

```{r execute p13-p14, echo=FALSE, fig.align='center'}
grid.arrange(p13, p14, ncol = 2)
```

## RACIAL BIAS IN POLICE SHOOTINGS OR ABOUT THE LIMITATIONS OF DATA

<p align="justify">
Now, let's take a look at a potential racism in police shootings. Such issue is acknowledged by many yet denied by other. maybe the data provided us with some findings that shed additional light on the question. In absolute terms we see that most people killed were white. More precisely, we see that 535 people were black, 367 were hispanic, and 1041 were white. So does that imply that there is not racial bias as former Arkansas governor Mike Huckabee said? Certainly not and you may think now that just comparing the numbers killed, to the corresponding numbers of that group in the general population is a good idea and provides us with a more reliable plot (The Washington Post uses this appraoch). And in fact doing so such as in plot 16 seems to change the picture drastically, since the plot now implies that black people are about two and half times as likely to be victims of lethal police violence. We may even take this thought a step further as in plot 17 and check if this bias is more significant in some states then in others. Note, that the plot does not includes all states because in some states such as New Mexico there are only white and hispanic victims. 
</p>

<p align="justify">
Let me be clear here, undoubtedly, African-Americans are being killed disproportionately and by a wide margin as the relative numbers show. However, from the plots above and the data they are based on, can we surely say that racism is responsible for those findings? Arguably we can not answer this question with the data because it may (or may not) also be the case that African-Americans just have a very large number of encounters with police officers of which every single one contains a base risk. (Though racism also may have an indirect effect if it is the cause for disproportionately many police encounters). A more thoroughly approach would therefore compare how often people of each race get killed by police, with how often people of the same race get arrested by police. Put differently, we need "two sided" event data. In general, if one wants to properly understand any kind of events (wars, dead etc.) collecting data only for cases where the event took place is generally a bad idea. Such an approach moreover easily can test the generalizability of potential findings and can incorporate confounding variables such as crime rates, weapons laws and so forth. 
</p>

<p align="justify">
To implement such an approach, we would need reliable and complete data for each arrest taking place across the US. And to make things clear here I'm not saying that there is or is not a racial bias either for shootings or more general regarding police discrimination. I just wanted to show that plots often can be misleading if not correctly applied and that people must be made aware of the limitation of data. EDA is not a tool for hypothesis testing and should not be wrongly misused as such. What EDA in this cases however clearly showed to my mind is that there is a problem with the amount of fatal police shootings across the US, though reasons probably are diverse and may or may not include racism.
</p>

```{r plot 15-18 code, messge=FALSE, warning=FALSE, include=FALSE}
p15 <- shootings %>% 
    filter(race =="B" | race == "W" | race == "H") %>%
    group_by(race) %>%
    summarize(shot = n()) %>%
    ggplot(aes(x = reorder(race, shot), y = shot)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P15: Shootings by race (absolute)")+ 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p18 <- shootings %>%
    filter(!is.na(race), !is.na(armed))  %>%
    filter(race =="B" | race == "W" | race == "H") %>%
    mutate(unar = ifelse(str_detect(armed, "unarmed"), "unarmed", "armed")) %>%
    group_by(race, unar) %>%
    summarize(shot = n()) %>%
    ggplot() +
        geom_bar(mapping = aes(x=race, y=shot,  fill=unar),
        position = "fill",stat = "identity")+ 
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P18: Shootings on unarmed by race") +
        scale_fill_brewer(palette="Paired") + 
        theme(text=element_text(size=8, family="Comic Sans MS"))+   
        theme(legend.title=element_blank()) 
    
p16 <- shootings %>%
    filter(race =="B" | race == "W" | race == "H") %>%
    mutate(white_total = sum(as.numeric(white), na.rm=TRUE), 
           black_total = sum(as.numeric(black), na.rm=TRUE), 
           hispa_total = sum(as.numeric(hispanic), na.rm=TRUE)) %>%
    group_by(race) %>%
    mutate(shot = n()) %>%
    mutate(shot_rel = ifelse(race == "B", shot/black_total*100000,
                      ifelse(race == "W", shot/white_total*100000,
                             shot/hispa_total*100000))) %>%
    select(race, shot_rel) %>% 
    filter (!duplicated(shot_rel)) %>% 
    ggplot(aes(x = reorder(race, shot_rel), y = shot_rel)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        xlab("") +
        ylab("") +
        ggtitle("P16: Shootings by race (relative)") + 
        theme(text=element_text(size=8, family="Comic Sans MS"))

p17 <- shootings %>%
    filter(!is.na(race)) %>%
    filter(race =="B" | race == "W" | race == "H") %>%
    mutate(white_total = sum(as.numeric(white), na.rm = TRUE), 
           black_total = sum(as.numeric(black), na.rm = TRUE), 
           hispa_total = sum(as.numeric(hispanic), na.rm = TRUE)) %>%
    group_by(race, state) %>%
    mutate(shot = n()) %>%
    mutate(shot_rel = ifelse(race == "B", shot/black_total*100000,
                      ifelse(race == "W", shot/white_total*100000,
                             shot/hispa_total*100000))) %>%
    select(race, shot_rel, state) %>% 
    filter (!duplicated(shot_rel)) %>% 
    filter(race =="B" | race == "W") %>%
    spread(race, shot_rel) %>% 
    mutate(ratio = B/W) %>%
    na.omit %>%
    ungroup() %>%
    mutate(ratio2 = ifelse(ratio > 1, ratio, 0-ratio)) %>%
    arrange(ratio) %>%
    ggplot(aes(x = reorder(state, ratio2), y = ratio2)) +
        geom_bar(stat='identity', color = "steelblue", fill = "white") +
        theme_gray() +
        coord_flip() +
        xlab("") +
        ylab("") +
        ggtitle("P17: Ratio between black victims per 100.000 black residents and white victims per 100.000 white residents")+ 
        theme(text=element_text(size=7, family="Comic Sans MS"))
```

```{r execute p15-p16, echo=FALSE, fig.align='center'}
grid.arrange(p15, p16, ncol = 2)
```

```{r execute p17, echo=FALSE, fig.align='center'}
p17
```

<p align="justify">
Given the data structure there is one last different perspective on which we can take a look on. While this approach is still not perfect it surely is better then the "race corrected" resident numbers because this time we compare the ratio of the event (shot unarmed) happening/not happening for different groups. 
So are blacks more likely to get shot if they are unarmed? Here, plot 18 indicates that there in fact may be a problem of racism. While 12 percent of the black victims were unarmed the same holds true only for 6 percent of the white people. Let's run some test statistics to further investigate this finding.
</p>

```{r execute p18, echo=FALSE, fig.align='center'}
p18
```

<p align="justify">
Let's run a simple test statistics to further investigate this finding. To do this I use the chi-squared test of independence which is one of the most basic and common hypothesis tests in the statistical analysis of categorical data.  Given 2 categorical random variables, X and Y, the chi-squared test of independence determines whether or not there exists a statistical dependence between them. The results provide evidence to suggest that race and the likelihood of being shot by the police if unarmed have some association. Again, this is a simpel test which only tell us whether two variables are related to one another. It does not necessarily imply that one variable has any causal effect on the other.   
</p>

```{r chi2 test, echo=FALSE, message=FALSE, warning=FALSE}
shootingsttest <- shootings %>% 
    filter(!is.na(race), !is.na(armed))  %>%
    filter(race == "B" | race == "W")  %>%
    mutate(unar = ifelse(str_detect(armed, "unarmed"), "unarmed", "armed")) %>%
    mutate(unar = as.factor(unar)) %>%
    droplevels() %>%
    select(race, unar)

chisq.test(table(shootingsttest$race, shootingsttest$unar))
```

<p align="justify">
Lastly, I also wanted to show the value of choropleth maps if you want to compare values across regions. Plot 19 is a simple and clean choropleth map showing number of shootings across the different states of the US. As seen in the plot fatal police shootings is a nation-wide problem, though, it differs across states. In absolute terms, Texas and California are at the higher end of the scale. Plot 20 investigates if there is a difference across states regarding the percentage of unarmed victims. The results are pretty surprising. While most of the states are below 10 perecent, there alarming exceptions with Iowa, Minnesota, Mississippi, and Maryland all above 15 percent. Note, that I excluded states with less then 8 victims.
</p>

```{r plot 19-20 code, message=FALSE, warning=FALSE, include=FALSE}
## get state coordinates and centers of states
state.coords <- map_data("state")
state.coords$region <- str_to_title(state.coords$region)
names(state.coords)[names(state.coords)=="region"] <- "state"
cnames <- aggregate(cbind(long, lat) ~ state, data=state.coords, 
                    FUN=function(x)mean(range(x)))

# create color scale 
colors <-brewer.pal(9, 'Blues')
pal <-colorRampPalette(colors)

# get data for map
map<- shootings %>%
    group_by(state) %>%
    mutate(shot = n(), shot_100000 = (shot/total_residents)*100000) %>%
    select(state, shot_100000) %>%
    filter(!duplicated(shot_100000)) %>%
    ungroup() %>%
    mutate(state = tolower(state)) %>%
    mutate(victims=ifelse(shot_100000 <= 0.5, "0-0.5",
                   ifelse(shot_100000 > 0.5 & shot_100000 <= 1, "0.6-1",
                   ifelse(shot_100000 > 1 & shot_100000 <= 1.5, "1.1-1.5",
                   ifelse(shot_100000 > 1.5 & shot_100000 <= 2,"1.6-2","2.1-2.5"))))) %>%
    mutate(victims = as.factor(victims)) %>%
    ggplot(aes(map_id = state)) + 
        geom_map(aes(fill = victims), map = fifty_states, colour = "white", lwd = 0.3) + 
        expand_limits(x = fifty_states$long, y = fifty_states$lat) +
        coord_map(project="conic", lat0 = 30) +
        scale_x_continuous(breaks = NULL) + 
        scale_y_continuous(breaks = NULL) +
        labs(x = "", y = "") +
        theme(legend.position = "bottom", panel.background = element_blank()) +
        theme_bw() +
        scale_fill_manual(name="Number of\n Incidents", values = pal(12)) + 
        labs(title="P19: Lethal Police Shootings in US States per 100.000 Residents (Jan. 2015-Feb. 2017)") +
        theme(text = element_text(size = 12, family = "Comic Sans MS")) +
        geom_text(aes(-91.4, 30.4, label = "Louisiana"), size=4) +
        geom_text(aes(-106.0, 34.3, label = "New Mexico"), size=4) +
        geom_text(aes(-97.3, 36.1, label = "Oaklahoma"), size=4) +
        geom_text(aes(-111.5, 34.0, label = "Arizona"), size=4) +
        geom_text(aes(-107.3, 43.1, label = "Wyoming"), size=4) +
        geom_text(aes(-81.7, 38.3, label = "West Virginia"), size=4) +
        geom_text(aes(-117, 40.0, label = "Nevada"), size=4) +
        geom_text(aes(-106, 39.0, label = "Colerado"), size=4) +
        geom_text(aes(-117.5, 28, label = "Alaska"), size=4)
        

# get data for map2
state_data2 <- shootings %>%
    filter(!is.na(armed)) %>%
    mutate(unar = ifelse(str_detect(armed, "unarmed"), "unarmed", "armed")) %>%
    group_by(state) %>% 
    summarize(vic=n(),prop=sum(unar=="unarmed")/n()) %>%
    filter(vic > 8) %>%
    mutate(prop=ifelse(prop <= 0.05, "0-5",
                   ifelse(prop > 0.05 & prop <= 0.10, "5-10",
                   ifelse(prop > 0.10 & prop <= 0.15, "10-15",
                   ifelse(prop > 0.15 & prop <= 0.20,"15-20",
                   ifelse(prop > 0.20 & prop <= 0.25,"15-20",
                   ifelse(prop > 0.25 & prop<=0.30,"25-30", "30-35"))))))) %>%
    mutate(prop = as.factor(prop))

# join state coordinate and value data map2
state.dat2 <- state.coords %>%
    inner_join(state_data2)

# set levels for map2 later on  (important because of label order)
state.dat2$prop <- factor(state.dat2$prop, 
                     levels=c("0-5", "5-10","10-15","15-20","25-30","30-35"), 
                     labels=c("0-5", "5-10","10-15","15-20", "25-30","30-35"))

## PLOT 20 ##

# basic map2
map2 <- ggplot(state.dat2)
map2 <- map2 + theme_bw()
map2 <- map2 + geom_polygon(aes(x = long, y = lat, 
                          group = group, fill = factor(prop)),
                          colour = "white", lwd = 0.3)
map2 <- map2 + coord_map(project="conic", lat0 = 30) 

# create color scale 
colors <-brewer.pal(9, 'PuBu')
pal <-colorRampPalette(colors)

# add a colors and a legend and title
map2 <- map2 + scale_fill_manual(name="Percent of\nUnarmed \nVictims ", values = pal(12) )
map2 <- map2 + guides(fill = guide_legend(override.aes = list(colour = NULL)))
map2 <- map2 + labs(title="P20: Unarmed Victims of Fatal Police Shootings in US States (Jan. 2015-Feb. 2017)")
map2 <- map2 + theme(text = element_text(size = 12, family = "Comic Sans MS"))

# blank axis ticks
map2 <- map2 + theme(axis.ticks = element_blank(),
                   axis.text.x = element_blank(),
                   axis.text.y = element_blank(),
                   axis.title.x= element_blank(),
                   axis.title.y= element_blank())
# hide gridlines
map2 <- map2 + theme(panel.grid.minor=element_blank(), panel.grid.major=element_blank()) +
        geom_text(aes(-93.5, 42, label = "Iowa"), size=4) +
        geom_text(aes(-76.6, 39, label = "Maryland"), size=4) +
        geom_text(aes(-89.5, 33, label = "Mississippi"), size=4) +
        geom_text(aes(-94.6, 46.3, label = "Minnesota"), size=4)
```

```{r execute p19-p20, echo=FALSE, fig.align='center'}
map 
map2
```

## CONCLUSION

<p align="justify">
I found that dataset to be very important, shocking, and interesting and the same time since it gave me an overview about the extend of fatal police shootings. And while the data was "cleaning-wise" not very challenging and also had it's limitation "plot-wise" (no "real" dependent variable) it still offers an excellent example for the limitation of EDA which is not a substitute for a proper statistical method but rather precedes it. While this should be natural and no new information I watched an interesting yet older episode of "Last Weeks Tonight" covering the use/misuse of data and scientific results in the media causing myself to think that for many people this is not the case. Finally, and I think I made that already clear enough to fully understand the problem we must collect much more sufficient data including non-lethal instances and more detail in general. The trouble is, that data could take years to compile. But only then can we come to reliable answers to question such as if there is a racial bias not only in nonletal police encounters but also in leathal ones. Lastly, I'm far from an expert in this topic but the following studies seem to provide more yet contradicting information based on sensible data analysis:
</p>

* Freyer, Roland, 2016: An Empirical Analysis of Racial Differences in Police Use of Force
* Nix, Justin, 2017: A Bird's Eye View of Civilians Killed by Police in 2015 

## MOST VALUABLE PLOTS

<p align="justify">
If I would be forced to choose three plots, for example for a short blog article, I would pick plot 1, plot 19, and plot 20 because I think they investigate the issue from different ankles, are well designed, and offer valuable insights. Note that I'm not sure about using the race related plots since people may jump to quick conclusions in one way or another, though if I would use any them I would pick plot 16 because it shows that blacks are unproportional often victims (without explaining it) or plot 18 because it is the most reasonable yet weak link between racist police officers and fatal shooting that I found in the data.
</p>

<p align="justify">
So what information would a potential reader get from the three chosen plots? Plot 1 to my mind clearly shows that there is an issue of great extend in the first place and that it does persist for at least two years. More, precisely readers would notice that on average 82 people per month have been fatally shot by police officers. With a shocking 987 victims in 2015 and 958 in 2016 - leaving 2132 citizens shot by the cops within two years.
Plot 19 adds a geographical component and illustrates that the issue is ,despite variations, not regional but rather nation-wide. Readers will recognize that some states, especially in the west and southwest have high numbers ranging from 1.6 to 2.5 per 100.000 residents within two years. For those who are not so comfortable with geography I added the state names. Lastly, plot 20 shows that victims are often unarmed indicating that the police's use of force often may be excessive. Again there are some specifically alarming states including Minnesota, Iowa, Mississippi, and Maryland. Each has an unarmed rate over 15% and to be clear here unarmed means no gun, play gun, knife, pipe, you name it, it means unarmed. 
</p> 

```{r, fig.align='center'}
p1
map
map2
```

## APPENDIX (CODE, ADDITIONAL PLOTS AND SUMMARIES)

```{r all_functions, message=FALSE, warning=FALSE}
###############
## FUNCTIONS ##
###############

# read dataset and join additional 
get_data <- function(){
    # read individual datasets
    shootings   <- fread("shootings.csv", na.strings=c("","NA"))
    state_pop   <- fread("states_pop.csv", na.strings=c("","NA"))
    state_race  <- fread("states_races.csv", na.strings=c("","NA"))
    state_rural <- fread("states_rural.csv", na.strings=c("","NA"))
    # change state abbrivation so that it can be used as key 
    shootings$state <- state.name[match(shootings$state,state.abb)]
    # change name of state variable so that it can be used as key 
    names(shootings)[names(shootings) =="state"] <- "Location"
    # join datasets
    shootings <- shootings     %>%
        inner_join(state_pop)  %>%
        inner_join(state_race) %>%
        inner_join(state_rural)%>%
        # drop useless variables 
        select(-name, -Nonmetropolitan,-Total) %>%
        # rename some variables
        rename(state  = Location)        %>%
        rename(manner = manner_of_death) %>%
        rename(camera = body_camera)     %>%
        rename(mental = signs_of_mental_illness) %>%
        rename(threat = threat_level)    %>%
        # unify variable names
        clean_names()
    return(shootings)
}

# relabel, re-name, re-level variables
adjust_variables_values <- function(df){
    # re-level variable armed
    df <- df %>%
    mutate(armed = ifelse(str_detect(armed, "gun"), "gun", 
                   ifelse(str_detect(armed, "vehicle"), "vehicle",
                   ifelse(str_detect(armed, "toy weapon"), "toy",
                   ifelse(str_detect(armed, "unarmed"), "unarmed", 
                          "other"))))) %>%
    # change values gender
    mutate(gender = ifelse(str_detect(gender, "M"), "Male", 
                    ifelse(str_detect(gender, "F"), "Female", NA))) %>%
    # re-level variable threat
    mutate(threat = ifelse(str_detect(threat, "attack"), "clear_attack", 
                           "no_clear_attack")) %>%
    # change values camera
    mutate(camera = ifelse(str_detect(camera, "TRUE"), "Yes", "No")) %>%
    # change values mental
    mutate(mental = ifelse(str_detect(mental, "TRUE"), "Yes", "No"))   
    return(df)
}

# get proper variable types
adjust_variable_types <- function(df){
    # declare date 
    df$date <- ymd(df$date)
    # declare integers
    df$black <- as.integer(df$black)
    df$asian <- as.integer(df$asian)
    # declare to factors if number of unique values < 10 
    n_unique_levels   <- sapply(df, function(x) length(unique(x)))
    factor_var_index  <- which(n_unique_levels < 10)
    df[ ,factor_var_index] <- lapply(df[ ,factor_var_index], factor)
    # declare to factors if string
    df <- df %>% 
        mutate_if(is.character,as.factor)
    return(df)
}
```

```{r summary_variables, echo=FALSE, message=FALSE, warning=FALSE}
dropvar <- c("id", "date", "total_residents", 
             "white", "black", "hispanic", 
             "asian", "metropolitan")

glimpse(shootings)

summary(shootings[ , !names(shootings) %in% dropvar])
```

```{r plot_nas, echo=FALSE, fig.align='center', warning=FALSE}
dropvar <- c("id", "date", "total_residents", 
             "white", "black", "hispanic", 
             "asian", "metropolitan")

aggr(shootings[ , !names(shootings) %in% dropvar] , prop = T, numbers = F)
```






